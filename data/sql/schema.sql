CREATE TABLE actividad_seguimiento (id BIGINT AUTO_INCREMENT, nombre VARCHAR(100) NOT NULL, descripcion LONGTEXT, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE asignacion (id BIGINT AUTO_INCREMENT, fecha DATE NOT NULL, discipulo_lider_id BIGINT NOT NULL, discipulo_nuevo_id BIGINT NOT NULL, UNIQUE INDEX Asignacion_idx (discipulo_lider_id, discipulo_nuevo_id), INDEX discipulo_nuevo_id_idx (discipulo_nuevo_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE asistencia (id BIGINT AUTO_INCREMENT, reunion_id BIGINT NOT NULL, miembro_celula_id BIGINT NOT NULL, INDEX reunion_id_idx (reunion_id), INDEX miembro_celula_id_idx (miembro_celula_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE celula (id BIGINT AUTO_INCREMENT, fecha DATE NOT NULL, dias_celula VARCHAR(45) NOT NULL, horario_celula TIME NOT NULL, discipulo_lider_id BIGINT UNIQUE NOT NULL, INDEX discipulo_lider_id_idx (discipulo_lider_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE sf_guard_user (id BIGINT AUTO_INCREMENT, first_name VARCHAR(255) NOT NULL, last_name VARCHAR(255) NOT NULL, email_address VARCHAR(255) NOT NULL UNIQUE, fecha_nac DATETIME NOT NULL, est_civil VARCHAR(15) NOT NULL, fotografia VARCHAR(255) DEFAULT NULL, genero SMALLINT NOT NULL, tipo_discipulo SMALLINT NOT NULL, codigo_lider_cdfe CHAR(10), direccion LONGTEXT NOT NULL, telefono VARCHAR(12), movil CHAR(12), sector_ciudad VARCHAR(100) NOT NULL, username VARCHAR(128) NOT NULL UNIQUE, algorithm VARCHAR(128) DEFAULT 'sha1' NOT NULL, salt VARCHAR(128), password VARCHAR(128), is_active TINYINT(1) DEFAULT '0', is_super_admin TINYINT(1) DEFAULT '0', last_login DATETIME, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX is_active_idx_idx (is_active), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE escuela (id BIGINT AUTO_INCREMENT, fecha_ingreso DATETIME NOT NULL, discipulo_id BIGINT NOT NULL, nivel_id BIGINT NOT NULL, INDEX discipulo_id_idx (discipulo_id), INDEX nivel_id_idx (nivel_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE evento (id BIGINT AUTO_INCREMENT, titulo TEXT NOT NULL, fecha_hora DATETIME NOT NULL, lugar LONGTEXT NOT NULL, descripcion LONGTEXT NOT NULL, discipulo_id BIGINT NOT NULL, INDEX discipulo_id_idx (discipulo_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE ficha (id BIGINT AUTO_INCREMENT, descripcion LONGTEXT, fecha DATE, tipo_indicador_id BIGINT NOT NULL, discipulo_id BIGINT NOT NULL, INDEX discipulo_id_idx (discipulo_id), INDEX tipo_indicador_id_idx (tipo_indicador_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE mensaje (id BIGINT AUTO_INCREMENT, titulo TEXT NOT NULL, estado TINYINT, contenido LONGTEXT NOT NULL, tipo_mensaje_id BIGINT NOT NULL, discipulo_id BIGINT NOT NULL, INDEX discipulo_id_idx (discipulo_id), INDEX tipo_mensaje_id_idx (tipo_mensaje_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE meta (id BIGINT AUTO_INCREMENT, titulo VARCHAR(200) NOT NULL, fecha_cumplir DATETIME NOT NULL, estado TINYINT NOT NULL, descripcion LONGTEXT NOT NULL, discipulo_id BIGINT NOT NULL, INDEX discipulo_id_idx (discipulo_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE miembro_celula (id BIGINT AUTO_INCREMENT, celula_id BIGINT NOT NULL, discipulo_id BIGINT NOT NULL, UNIQUE INDEX MiembroDeCelula_idx (celula_id, discipulo_id), INDEX discipulo_id_idx (discipulo_id), INDEX celula_id_idx (celula_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE nivel_escuela (id BIGINT AUTO_INCREMENT, nombre VARCHAR(100) NOT NULL, descripcion LONGTEXT NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE reunion (id BIGINT AUTO_INCREMENT, fecha DATE NOT NULL, palabra LONGTEXT NOT NULL, observaciones LONGTEXT NOT NULL, celula_id BIGINT NOT NULL, INDEX celula_id_idx (celula_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE seguimiento (id BIGINT AUTO_INCREMENT, descripcion LONGTEXT NOT NULL, fecha DATE NOT NULL, asignacion_id BIGINT NOT NULL, actividad_seguimiento_id BIGINT NOT NULL, INDEX asignacion_id_idx (asignacion_id), INDEX actividad_seguimiento_id_idx (actividad_seguimiento_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE tipo_indicador (id BIGINT AUTO_INCREMENT, indicador VARCHAR(100) NOT NULL, tipo_discipulo SMALLINT NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE tipo_mensaje (id BIGINT AUTO_INCREMENT, nombre VARCHAR(50) NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE sf_guard_forgot_password (id BIGINT AUTO_INCREMENT, user_id BIGINT NOT NULL, unique_key VARCHAR(255), expires_at DATETIME NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX user_id_idx (user_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE sf_guard_group (id BIGINT AUTO_INCREMENT, name VARCHAR(255) UNIQUE, description TEXT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE sf_guard_group_permission (group_id BIGINT, permission_id BIGINT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(group_id, permission_id)) ENGINE = INNODB;
CREATE TABLE sf_guard_permission (id BIGINT AUTO_INCREMENT, name VARCHAR(255) UNIQUE, description TEXT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE sf_guard_remember_key (id BIGINT AUTO_INCREMENT, user_id BIGINT, remember_key VARCHAR(32), ip_address VARCHAR(50), created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX user_id_idx (user_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE sf_guard_user_group (user_id BIGINT, group_id BIGINT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(user_id, group_id)) ENGINE = INNODB;
CREATE TABLE sf_guard_user_permission (user_id BIGINT, permission_id BIGINT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(user_id, permission_id)) ENGINE = INNODB;
ALTER TABLE asignacion ADD CONSTRAINT asignacion_discipulo_nuevo_id_sf_guard_user_id FOREIGN KEY (discipulo_nuevo_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE asistencia ADD CONSTRAINT asistencia_reunion_id_reunion_id FOREIGN KEY (reunion_id) REFERENCES reunion(id) ON DELETE RESTRICT;
ALTER TABLE asistencia ADD CONSTRAINT asistencia_miembro_celula_id_miembro_celula_id FOREIGN KEY (miembro_celula_id) REFERENCES miembro_celula(id) ON DELETE RESTRICT;
ALTER TABLE celula ADD CONSTRAINT celula_discipulo_lider_id_sf_guard_user_id FOREIGN KEY (discipulo_lider_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE escuela ADD CONSTRAINT escuela_nivel_id_nivel_escuela_id FOREIGN KEY (nivel_id) REFERENCES nivel_escuela(id) ON DELETE CASCADE;
ALTER TABLE escuela ADD CONSTRAINT escuela_discipulo_id_sf_guard_user_id FOREIGN KEY (discipulo_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE evento ADD CONSTRAINT evento_discipulo_id_sf_guard_user_id FOREIGN KEY (discipulo_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE ficha ADD CONSTRAINT ficha_tipo_indicador_id_tipo_indicador_id FOREIGN KEY (tipo_indicador_id) REFERENCES tipo_indicador(id) ON DELETE CASCADE;
ALTER TABLE ficha ADD CONSTRAINT ficha_discipulo_id_sf_guard_user_id FOREIGN KEY (discipulo_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE mensaje ADD CONSTRAINT mensaje_tipo_mensaje_id_tipo_mensaje_id FOREIGN KEY (tipo_mensaje_id) REFERENCES tipo_mensaje(id) ON DELETE CASCADE;
ALTER TABLE mensaje ADD CONSTRAINT mensaje_discipulo_id_sf_guard_user_id FOREIGN KEY (discipulo_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE meta ADD CONSTRAINT meta_discipulo_id_sf_guard_user_id FOREIGN KEY (discipulo_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE miembro_celula ADD CONSTRAINT miembro_celula_discipulo_id_sf_guard_user_id FOREIGN KEY (discipulo_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE miembro_celula ADD CONSTRAINT miembro_celula_celula_id_celula_id FOREIGN KEY (celula_id) REFERENCES celula(id) ON DELETE RESTRICT;
ALTER TABLE reunion ADD CONSTRAINT reunion_celula_id_celula_id FOREIGN KEY (celula_id) REFERENCES celula(id) ON DELETE RESTRICT;
ALTER TABLE seguimiento ADD CONSTRAINT seguimiento_asignacion_id_asignacion_id FOREIGN KEY (asignacion_id) REFERENCES asignacion(id) ON DELETE CASCADE;
ALTER TABLE seguimiento ADD CONSTRAINT seguimiento_actividad_seguimiento_id_actividad_seguimiento_id FOREIGN KEY (actividad_seguimiento_id) REFERENCES actividad_seguimiento(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_forgot_password ADD CONSTRAINT sf_guard_forgot_password_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_group_permission ADD CONSTRAINT sf_guard_group_permission_permission_id_sf_guard_permission_id FOREIGN KEY (permission_id) REFERENCES sf_guard_permission(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_group_permission ADD CONSTRAINT sf_guard_group_permission_group_id_sf_guard_group_id FOREIGN KEY (group_id) REFERENCES sf_guard_group(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_remember_key ADD CONSTRAINT sf_guard_remember_key_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_user_group ADD CONSTRAINT sf_guard_user_group_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_user_group ADD CONSTRAINT sf_guard_user_group_group_id_sf_guard_group_id FOREIGN KEY (group_id) REFERENCES sf_guard_group(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_user_permission ADD CONSTRAINT sf_guard_user_permission_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_user_permission ADD CONSTRAINT sf_guard_user_permission_permission_id_sf_guard_permission_id FOREIGN KEY (permission_id) REFERENCES sf_guard_permission(id) ON DELETE CASCADE;
